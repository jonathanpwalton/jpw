#!/usr/bin/env bash

set -e

declare -r ProgramName="jpw"
declare -r ProgramVersion="20250331"
declare -r ProgramDescription="A bash-powered package manager for GNU/Linux"

function bold {
  if tput sgr0; then
    echo "$(tput bold)$1$(tput sgr0)"
  else
    echo "$1"
  fi
}

function underline {
  if tput sgr0; then
    echo "$(tput smul)$1$(tput rmul)"
  else
    echo "$1"
  fi
}

function error {
  echo "$(bold Error): $1"
  exit 1
}

function main {
  local -r SRC="$(basename "$0")"

  if test $# = 0; then
    error "a command must be supplied, see '$(bold "$SRC help")' for more information"
  elif test "$1" = "help" || test "$1" = "-h" || test "$1" = "--help"; then
    if test $# != 1; then
      echo "Error: the '$1' command does not take any arguments, see '$(bold "$SRC help")' for more information"
      exit 1
    fi

    bold "$ProgramName $ProgramVersion"
    echo "$ProgramDescription"
    echo
    echo "$(underline "$(bold Usage)"): $(bold "$SRC") <command>"
    echo
    echo "$(underline "$(bold Commands)"):"
    echo "  $(bold update) [available | installed]                          Update available, installed, or all packages"
    echo "  $(bold install) {<package> [-v <version>] [-c <config>] ...}    Fetch and install one or more packages"
    echo "  $(bold remove) {<package> ...}                                  Uninstall and remove one or more packages"
    echo "  $(bold list) {available | installed}                            Display all available or installed packages"
    echo "  $(bold help)                                                    Display this help text and exit"
    exit 0
  else
    error "the command '$1' was not recognized, see '$(bold "$SRC help")' for more information"
  fi
}

main "$@"

# grep -Pzo 'lzip\n(\s.*\n)+' available | grep ^lzip$